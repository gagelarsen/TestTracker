{% extends "test_tracker/dashboard.html" %}

{% block test_tracker_content %}

<!--<style>-->
<!--    #contextMenu {-->
<!--      position: absolute;-->
<!--    }-->
<!--</style>-->

{% if user.is_authenticated %}
<ul id="contextMenu" class="dropdown-menu" role="menu">
    <li><a id="update-testcase-context" class="context-menu-list update-testcase" tabindex="-1"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Edit Test</a></li>
</ul>
{% endif %}

<div class="row">
    <div class="col-sm-3 col-md-2 sidebar" id="sidebar"></div>
    <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
        <h1 class="page-header">Test Cases for review in {{ product.name }}-{{ product.version }}</h1>
        <div class="container">
            {% if testcases %}
                <table class="table table-striped">
                    <thead class="thead-dark">
<!--                        <tr>-->
                            <th class="sortable">Test</th>
                            <th class="sortable">Summary</th>
<!--                        </tr>-->
                    </thead>
                    <tbody>
                        {% for testcase in testcases %}
                            <tr>
                                <td>{{ testcase.name }}</td>
                                <td>{{ testcase.summary }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <h3>There are no Testcases marked as Needs Review!</h3>
            {% endif %}
        </div>
    </div>
</div>

<script>
    // Sorting table
    $('th').click(function(){
        var table = $(this).parents('thead').eq(0).parents('table').eq(0)
        var rows = table.find('tr:gt(0)').toArray().sort(comparer($(this).index()))
        this.asc = !this.asc
        if (!this.asc){rows = rows.reverse()}
        for (var i = 0; i < rows.length; i++){table.append(rows[i])}
    })

    $('button .no-sort').click(function() {
        event.stopPropagation();
    })

    function comparer(index) {
        return function(a, b) {
            var valA = getCellValue(a, index), valB = getCellValue(b, index)
            return $.isNumeric(valA) && $.isNumeric(valB) ? valA - valB : valA.toString().localeCompare(valB)
        }
    }

    function getCellValue(row, index){
        return $(row).children('td').eq(index).text()
    }

    // Context menu
    var contextMenuClone = undefined;
    $(document).ready(function() {
        $('body').click(function () {
            $("#contextMenu").hide();
        });
    });
    $("#dashboard").load(dashboard_url, function() {
        contextMenuClone = $("#contextMenu").clone();
    });

</script>

{% endblock %}